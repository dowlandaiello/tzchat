name: Homelab Deployment
on: [push]
jobs:
  Start-Cargo-Server:
    runs-on: [self-hosted, linux, x64]
    steps:
      - run: echo "checking out GitHub repo..."
      - run: pwd
      - run: cd tzchat || (git clone git@github.com:dowlandaiello/tzchat && cd tzchat)
      - run: pwd
      - run: cd tzchat/tzchat
      - run: echo "checking systemd configuration..."
      - run: stat $HOME/.local/share/systemd/user/tzchat.service || ./create_systemd.sh > $HOME/.local/share/systemd/user/tzchat.service
      - run: echo "building and starting actix server..."
      - run: cargo build
      - run: echo "spawning actix server..."
      - run: systemctl --user restart tzhschat
